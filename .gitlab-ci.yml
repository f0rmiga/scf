.tags: &tags
- personal-minikube-tassis

stages:
- lint
- build
- publish

lint:
  stage: lint
  tags: *tags
  image: thulioassis/bazel-docker-image:0.29.1
  script:
  - ./dev/linters/shellcheck.sh

build:chart:
  stage: build
  tags: *tags
  image: thulioassis/bazel-docker-image:0.29.1
  script:
  - bazel build //deploy/helm/scf:chart
  - mkdir -p output; (cd bazel-bin/deploy/helm/scf; tar cf - .) | (cd output; tar xvf -)
  artifacts:
    paths:
    - output/scf-*.tgz
    expire_in: 1 week

publish:chart:
  stage: publish
  tags: *tags
  image: opensuse/leap:15.1
  script:
  - ls output/
